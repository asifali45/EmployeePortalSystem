@model List<EmployeePortalSystem.ViewModels.SupportTicketViewModel>

@{
    ViewData["Title"] = "Assigned Tickets";
    Layout = "~/Views/Shared/EmployeeLayout.cshtml";
}

<div class="container">
    <div class="page-contents">

        <div class="emp_btn">
            <div class="left_btn">
                <form method="get" asp-action="EmployeeTicket" asp-controller="SupportTicket">
                    <button type="submit" class="create_emp_btn">Back</button>
                </form>
            </div>
        </div>

        <div class="emp_head">
            <h2>Tickets Assigned To Me</h2>
        </div>

        <div class="empmaster_card">
            <table class="table emp_table">
                <thead>
                    <tr>
                        <th>Ticket ID</th>
                        <th>Issue</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Resolved</th> 
                        <th>Action</th>   
                    </tr>
                </thead>
                <tbody>
                    @foreach (var ticket in Model)
                    {
                        <tr>
                            <form method="post" asp-action="UpdateResolution" asp-controller="SupportTicket">
                             @Html.AntiForgeryToken()
                             <input type="hidden" name="TicketId" value="@ticket.TicketId" />
                            <td>@ticket.TicketId</td>
                            <td>@ticket.IssueTitle</td>
                            <td>@ticket.Description</td>
                            <td>@ticket.Status</td>
                             <td>
                                <select name="Resolved" class="form-control">
                                    <option value="">-- Select Resolution --</option>

                                    @if (ticket.Resolved == "Closed")
                                    {
                                        <option value="Closed" selected>Closed</option>
                                    }
                                    else
                                    {
                                        <option value="Closed">Closed</option>
                                    }

                                    @if (ticket.Resolved == "Set to Senior")
                                    {
                                        <option value="Set to Senior" selected>Set to Senior</option>
                                    }
                                    else
                                    {
                                        <option value="Set to Senior">Set to Senior</option>
                                    }
                                </select>
                            </td>
                            <td>
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                            </td>
                            </form>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

    </div>
</div>

@section Scripts {
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#assignedTicketsTable').DataTable();
        });
    </script>
}
